<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pixel Art Editor</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .layout {
      display: flex;
    }

    .canvasholder {
      width: 50%;
      padding: 1rem;
    }

    .dimensioninput {
      margin-bottom: 1rem;
    }

    .controls {
      width: 50%;
      padding: 1rem;
    }

    canvas {
      /* transform: scale(10); */
      image-rendering: pixelated;
      transform-origin: top left;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .canvas-sizer {
      position: relative;
      width: 160px;
      height: 160px;
    }

    .import-export {
      margin-top: 2rem;
    }

    .color-palette {
      display: flex;
      flex-wrap: wrap;
      width: 140px;
    }

    .color {
      width: 32px;
      height: 32px;
      cursor: pointer;
    }

    textarea {
      margin-top: 1rem;
      width: 400px;
      height: 200px;
    }

    input {
      margin-top: 1rem;
      width: 50px;
    }
  </style>
</head>

<body>

  <div class="layout">
    <div class="canvasholder">
      <div class="dimensioninput">
        <label for="widthInput">Width:</label>
        <input type="number" id="widthInput" value="16" min="1">
        <label for="heightInput">Height:</label>
        <input type="number" id="heightInput" value="16" min="1">
      </div>

      <div class="canvas-sizer">
        <canvas id="pixelCanvas" width="16" height="16"></canvas>
        <canvas id="cursorCanvas" width="16" height="16"></canvas>
      </div>
    </div>

    <div class="controls">
      <div class="color-palette">
        <div class="color" style="background-color: #424242;"></div>
        <div class="color" style="background-color: #858585;"></div>
        <div class="color" style="background-color: #c8c8c8;"></div>
        <div class="color" style="background-color: #ffffff;"></div>
        <div class="color" style="background-color: #201888;"></div>
        <div class="color" style="background-color: #2038e8;"></div>
        <div class="color" style="background-color: #5890f8;"></div>
        <div class="color" style="background-color: #c0d0f8;"></div>
        <div class="color" style="background-color: #880070;"></div>
        <div class="color" style="background-color: #b800b8;"></div>
        <div class="color" style="background-color: #f078f8;"></div>
        <div class="color" style="background-color: #f8b8f8;"></div>
        <div class="color" style="background-color: #a00000;"></div>
        <div class="color" style="background-color: #d82842;"></div>
        <div class="color" style="background-color: #f87060;"></div>
        <div class="color" style="background-color: #f8b8b0;"></div>
        <div class="color" style="background-color: #724007;"></div>
        <div class="color" style="background-color: #887000;"></div>
        <div class="color" style="background-color: #c7b41c;"></div>
        <div class="color" style="background-color: #dccf70;"></div>
        <div class="color" style="background-color: #005000;"></div>
        <div class="color" style="background-color: #00a800;"></div>
        <div class="color" style="background-color: #48d848;"></div>
        <div class="color" style="background-color: #a8f8b8;"></div>
        <div class="color" style="background-color: #183858;"></div>
        <div class="color" style="background-color: #008088;"></div>
        <div class="color" style="background-color: #00e8d9;"></div>
        <div class="color" style="background-color: #98f8f0;"></div>
        <div class="color" style="background-color: #000000;"></div>
      </div>
    </div>
  </div>

  <div class="import-export">
    <button onclick="exportPixels()">Export Pixels</button>
    <br>
    <textarea id="exportTextArea" readonly></textarea>
  </div>

  <script>
    const texelLookupTable = {
      "#000000": ['.', 'm'], // Black

      "#424242": ['o', 'm'], // Grays
      "#858585": ['*', 'm'],
      "#c8c8c8": ['7', 'm'],
      "#ffffff": ['#', 'm'],

      "#201888": ['o', 'b'], // Blues
      "#2038e8": ['*', 'b'],
      "#5890f8": ['7', 'b'],
      "#c0d0f8": ['#', 'b'],

      "#880070": ['o', 'p'], // Pinks
      "#b800b8": ['*', 'p'],
      "#f078f8": ['7', 'p'],
      "#f8b8f8": ['#', 'p'],

      "#a00000": ['o', 'r'], // Reds
      "#d82842": ['*', 'r'],
      "#f87060": ['7', 'r'],
      "#f8b8b0": ['#', 'r'],

      "#724007": ['o', 'o'], // Oranges
      "#887000": ['*', 'o'],
      "#c7b41c": ['7', 'o'],
      "#dccf70": ['#', 'o'],

      "#005000": ['o', 'g'], // Greens
      "#00a800": ['*', 'g'],
      "#48d848": ['7', 'g'],
      "#a8f8b8": ['#', 'g'],

      "#183858": ['o', 't'], // Teals
      "#008088": ['*', 't'],
      "#00e8d9": ['7', 't'],
      "#98f8f0": ['#', 't'],
    };

    const widthInput = document.getElementById("widthInput");
    const heightInput = document.getElementById("heightInput");

    const canvas = document.getElementById("pixelCanvas");
    const cCanvas = document.getElementById("cursorCanvas");
    const ctx = canvas.getContext("2d");
    const cCtx = cCanvas.getContext("2d");
    let currentColor = "#000"; // Default color is black

    // Set every pixel on the canvas to black initially
    resetCanvas();

    widthInput.addEventListener("input", resetCanvas);
    heightInput.addEventListener("input", resetCanvas);

    cCanvas.addEventListener("mousemove", showCursorPreview);

    cCanvas.addEventListener("mousedown", function (e) {
      drawPixel(e);
      cCanvas.addEventListener("mousemove", drawPixel);
    });

    cCanvas.addEventListener("mouseup", function () {
      cCanvas.removeEventListener("mousemove", drawPixel);
    });
    cCanvas.addEventListener("mouseleave", function () {
      cCanvas.removeEventListener("mousemove", drawPixel);
    });

    function resetCanvas() {
      const width = parseInt(widthInput.value);
      const height = parseInt(heightInput.value);

      canvas.width = width;
      canvas.height = height;

      ctx.fillStyle = currentColor;
      ctx.fillRect(0, 0, width, height);
    }

    function showCursorPreview(e) {
      const x = Math.floor((e.offsetX / cCanvas.clientWidth) * cCanvas.width);
      const y = Math.floor((e.offsetY / cCanvas.clientHeight) * cCanvas.height);

      // Clear previous preview
      cCtx.clearRect(0, 0, cCanvas.width, cCanvas.height);

      // Draw preview pixel
      cCtx.fillStyle = currentColor;
      cCtx.fillRect(x, y, 1, 1);
    }

    function drawPixel(e) {
      const x = Math.floor((e.offsetX / canvas.clientWidth) * canvas.width);
      const y = Math.floor((e.offsetY / canvas.clientHeight) * canvas.height);

      ctx.fillStyle = currentColor;
      ctx.fillRect(x, y, 1, 1);
    }


    // Color Selector
    document.querySelectorAll(".color").forEach((element) => {
      element.addEventListener("click", () => {
        currentColor = element.style.backgroundColor;
      });
    });

    // Pixel Export
    function exportPixels() {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
      let pixelArray = [];

      for (let i = 0; i < imageData.length; i += 4) {
        const red = imageData[i].toString(16).padStart(2, '0');
        const green = imageData[i + 1].toString(16).padStart(2, '0');
        const blue = imageData[i + 2].toString(16).padStart(2, '0');

        const hexValue = `#${red}${green}${blue}`;

        // convert the hexValue to the corresponding Texel Value
        const currentTexel = texelLookupTable[hexValue];

        pixelArray.push(currentTexel);
      }


      const arrayString = JSON.stringify(pixelArray, null, 2)
        .replace(/\n/g, '')
        .replace(/\s{2,}/g, ' ');
      // Set the text area value


      const exportTextArea = document.getElementById("exportTextArea");

      exportTextArea.value = arrayString;
      // // console.log(pixelArray);
      // exportTextArea.value = pixelArray.join('||||');
    }
  </script>
</body>

</html>